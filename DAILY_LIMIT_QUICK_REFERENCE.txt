================================================================================
DAILY AI USAGE LIMIT - QUICK REFERENCE
================================================================================

‚úÖ SYSTEM STATUS: FULLY IMPLEMENTED & WORKING

The daily AI usage limit system is already built into your app. It:
  ‚Ä¢ Checks before EVERY AI generation
  ‚Ä¢ Increments counter after SUCCESS
  ‚Ä¢ Resets at 00:00 UTC each day
  ‚Ä¢ Shows "try again tomorrow" messages

================================================================================
QUICK COMMANDS
================================================================================

CHECK USER'S TODAY'S USAGE:
  SELECT * FROM daily_ai_usage 
  WHERE user_id = 'USER_UUID' AND usage_date = CURRENT_DATE;

SET CUSTOM LIMIT (e.g., 5 per day):
  INSERT INTO account_limits (user_id, daily_ai_limit) 
  VALUES ('USER_UUID', 5)
  ON CONFLICT (user_id) DO UPDATE SET daily_ai_limit = 5;

RESET TODAY'S COUNTER:
  DELETE FROM daily_ai_usage 
  WHERE user_id = 'USER_UUID' AND usage_date = CURRENT_DATE;

LIST USERS WHO HIT TODAY'S LIMIT:
  SELECT u.user_id, u.count, l.daily_ai_limit
  FROM daily_ai_usage u
  LEFT JOIN account_limits l ON u.user_id = l.user_id
  WHERE u.usage_date = CURRENT_DATE 
    AND u.count >= COALESCE(l.daily_ai_limit, 1);

================================================================================
HOW IT WORKS
================================================================================

User tries to generate ‚Üí Check limit ‚Üí Can generate?
  
  YES (count < limit):
    ‚úÖ Allow generation
    ‚úÖ After success: increment count
    ‚úÖ User gets content
  
  NO (count >= limit):
    ‚ùå Return 429 error
    ‚ùå Show message: "Daily AI limit reached. Please try again tomorrow."
    ‚ùå All AI features blocked until tomorrow

================================================================================
DEFAULT LIMITS
================================================================================

Default daily limit: 1 generation per user per day

Can be customized per user via account_limits table.

All times in UTC. Resets at 00:00 UTC every day.

================================================================================
WHERE IT'S CHECKED
================================================================================

EDGE FUNCTION:
  ‚Ä¢ supabase/functions/ai-generate/index.ts
  ‚Ä¢ Function: checkDailyLimitOrThrow() - called before any AI operation
  ‚Ä¢ Function: incrementDailyUsage() - called after success

FRONTEND:
  ‚Ä¢ SummaryView - Toast: "Daily AI limit reached. Please try again tomorrow."
  ‚Ä¢ QuizView - Error state
  ‚Ä¢ ExercisesView - Error state  
  ‚Ä¢ FlashcardsView - Error state
  ‚Ä¢ FeynmanView - Feedback message
  ‚Ä¢ AIChatPanel - Chat message
  ‚Ä¢ ProcessingPage - Upload error handling

================================================================================
WHAT COUNTS AS 1 GENERATION
================================================================================

‚úì Chat message          ‚Üí AIChatPanel
‚úì Transcribe audio      ‚Üí ProcessingPage, Upload
‚úì Generate summary      ‚Üí SummaryView
‚úì Generate quiz         ‚Üí QuizView
‚úì Generate exercises    ‚Üí ExercisesView
‚úì Generate flashcards   ‚Üí FlashcardsView
‚úì Feynman feedback      ‚Üí FeynmanView
‚úì Auto-generate title   ‚Üí ProcessingPage (during transcription)

Each of these increments the daily counter by 1.

================================================================================
MONITORING
================================================================================

Check edge function logs for:
  [RATE_LIMIT_CHECK] üîç Starting Rate Limit Check
  [RATE_LIMIT_CHECK] üìä Current Usage: X/Y
  [RATE_LIMIT_CHECK] ‚õî LIMIT REACHED!
  [INCREMENT_USAGE] üìù Incrementing daily usage count

Location: Supabase Dashboard ‚Üí Functions ‚Üí ai-generate ‚Üí Logs

================================================================================
ERROR MESSAGES USERS SEE
================================================================================

When daily limit is hit:
  "Daily AI limit reached (15/day). Please try again tomorrow."

With specific reset time:
  "Daily AI limit reached. Please try again after 11:30 PM."

In processing page:
  "Daily AI limit reached. Please try again tomorrow."

================================================================================
TROUBLESHOOTING
================================================================================

‚ùå User can still generate after hitting limit?
  ‚Üí Verify edge function was deployed: supabase functions deploy ai-generate
  ‚Üí Check table exists: SELECT COUNT(*) FROM daily_ai_usage;
  ‚Üí Check RLS is disabled: ALTER TABLE daily_ai_usage DISABLE ROW LEVEL SECURITY;

‚ùå Count not incrementing?
  ‚Üí Check edge function logs for [INCREMENT_USAGE] errors
  ‚Üí Verify database connection
  ‚Üí Ensure record was created before incrementing

‚ùå Wrong reset time shown?
  ‚Üí Times use UTC timezone
  ‚Üí Reset is always 00:00 UTC next day
  ‚Üí User's local timezone is just for display

================================================================================
DATABASE SCHEMA
================================================================================

TABLE: daily_ai_usage
  user_id UUID (links to auth.users)
  usage_date DATE (YYYY-MM-DD in UTC)
  count INT (0-N generations used)
  created_at TIMESTAMPTZ (when record created)
  
  PRIMARY KEY: (user_id, usage_date)
  RLS: DISABLED (for edge function access)

TABLE: account_limits
  user_id UUID PRIMARY KEY (custom limit per user)
  daily_ai_limit INT (default 1 if not set)
  
  RLS: DISABLED (for edge function access)

================================================================================
FILES INVOLVED
================================================================================

Backend:
  ‚Ä¢ supabase/functions/ai-generate/index.ts
    - checkDailyLimitOrThrow()
    - incrementDailyUsage()
  
  ‚Ä¢ supabase-schema.sql
    - daily_ai_usage table
    - account_limits table

Frontend:
  ‚Ä¢ src/services/aiGateway.ts
    - RateLimitError handling
    - DAILY_LIMIT_REACHED error code
  
  ‚Ä¢ src/components/note/study-modes/*.tsx
    - SummaryView
    - QuizView
    - ExercisesView
    - FlashcardsView
    - FeynmanView
  
  ‚Ä¢ src/components/note/AIChatPanel.tsx
    - Chat error handling

================================================================================
FOR MORE DETAILS
================================================================================

See:
  ‚Ä¢ DAILY_AI_USAGE_RATE_LIMITING.md - Full technical documentation
  ‚Ä¢ DAILY_LIMIT_IMPLEMENTATION.md - Implementation details
  ‚Ä¢ supabase-schema.sql - Database schema
  ‚Ä¢ supabase/functions/ai-generate/index.ts - Backend logic

================================================================================
‚úÖ SYSTEM IS PRODUCTION READY

The daily AI usage limit is fully implemented, tested, and working.
No additional changes needed - just deploy and monitor!

================================================================================
